<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Acting Intern - Clinical Simulation</title>
    <link rel="stylesheet" href="css/epic-theme.css?v=20260224b">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app">
        <!-- Top Header Bar -->
        <header class="top-header">
            <div class="header-left">
                <div class="logo"><span class="logo-ai">A</span>cting <span class="logo-ai">I</span>ntern</div>
                <div class="patient-search">
                    <input type="text" id="patient-search" placeholder="Search patients..." autocomplete="off">
                    <div id="search-results" class="search-dropdown"></div>
                </div>
                <div class="keyboard-hint" onclick="GlobalSearch.open()" style="cursor: pointer;">
                    <span>Search Chart</span>
                    <kbd>Ctrl</kbd><kbd>K</kbd>
                </div>
            </div>
            <div class="header-center" id="patient-banner">
                <!-- Patient info populated by JS -->
            </div>
            <div class="header-right">
                <span class="current-time" id="current-time"></span>
                <a href="#/about" class="header-about-link">About</a>
            </div>
        </header>

        <!-- Allergy Banner -->
        <div class="allergy-banner" id="allergy-banner">
            <!-- Allergies populated by JS -->
        </div>

        <!-- Main Content Area -->
        <div class="main-container">
            <!-- Left Navigation -->
            <nav class="sidebar" id="sidebar">
                <div class="nav-section">
                    <div class="nav-section-title">Patient Chart</div>
                    <a href="#/chart-review" class="nav-item active" data-section="chart-review">
                        <span class="nav-icon">&#9632;</span>
                        Chart Review
                    </a>
                    <a href="#/encounters" class="nav-item" data-section="encounters">
                        <span class="nav-icon">&#128197;</span>
                        Encounters
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Clinical</div>
                    <a href="#/notes" class="nav-item" data-section="notes">
                        <span class="nav-icon">&#128196;</span>
                        Notes
                    </a>
                    <a href="#/problems" class="nav-item" data-section="problems">
                        <span class="nav-icon">&#9733;</span>
                        Problem List
                    </a>
                    <a href="#/medications" class="nav-item" data-section="medications">
                        <span class="nav-icon">&#128138;</span>
                        Medications
                    </a>
                    <a href="#/allergies" class="nav-item" data-section="allergies">
                        <span class="nav-icon">&#9888;</span>
                        Allergies
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Results</div>
                    <a href="#/labs" class="nav-item" data-section="labs">
                        <span class="nav-icon">&#128300;</span>
                        Labs
                    </a>
                    <a href="#/imaging" class="nav-item" data-section="imaging">
                        <span class="nav-icon">&#128444;</span>
                        Imaging
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Orders</div>
                    <a href="#/orders" class="nav-item" data-section="orders">
                        <span class="nav-icon">&#128203;</span>
                        Orders
                    </a>
                    <a href="#/procedures" class="nav-item" data-section="procedures">
                        <span class="nav-icon">&#128137;</span>
                        Procedures
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Flowsheets</div>
                    <a href="#/vitals" class="nav-item" data-section="vitals">
                        <span class="nav-icon">&#10084;</span>
                        Vitals
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">History</div>
                    <a href="#/social-history" class="nav-item" data-section="social-history">
                        <span class="nav-icon">&#128101;</span>
                        Social History
                    </a>
                    <a href="#/family-history" class="nav-item" data-section="family-history">
                        <span class="nav-icon">&#128106;</span>
                        Family History
                    </a>
                    <a href="#/immunizations" class="nav-item" data-section="immunizations">
                        <span class="nav-icon">&#128137;</span>
                        Immunizations
                    </a>
                </div>
            </nav>

            <!-- Content Area -->
            <main class="content" id="main-content">
                <!-- Dynamic content loaded here -->
                <div class="loading">Loading...</div>
            </main>

            <!-- AI Side Panel -->
            <aside class="ai-panel" id="ai-panel">
                <!-- Resize handle -->
                <div class="ai-panel-resize-handle" id="ai-panel-resize-handle"></div>
                <!-- Top bar with settings + collapse -->
                <div class="ai-panel-topbar">
                    <span class="ai-panel-topbar-title">&#10024; <span class="logo-animated"><span class="logo-ai">A</span><span class="logo-rest">cting </span><span class="logo-ai">I</span><span class="logo-rest">ntern</span></span></span>
                    <div class="ai-panel-header-actions">
                        <button class="ai-settings-btn-header" onclick="AIPanel.openSettings()" title="AI Settings">
                            <span>&#9881;</span>
                        </button>
                        <button class="ai-panel-toggle" onclick="AIPanel.toggle()" title="Toggle AI Panel">
                            <span class="toggle-icon">&#10095;</span>
                        </button>
                    </div>
                </div>

                <!-- Copilot Content -->
                <div class="copilot-content" id="tab-copilot">
                    <div id="assistant-tab-body">
                        <div class="ai-empty">
                            <div class="empty-icon">&#10024;</div>
                            <div class="empty-text"><span class="logo-ai">A</span>cting <span class="logo-ai">I</span>ntern</div>
                            <div class="empty-hint">Loading patient data...</div>
                        </div>
                    </div>
                </div>

                <!-- Settings Panel (hidden by default) -->
                <div class="ai-settings-panel" id="ai-settings-panel">
                    <div class="settings-header">
                        <h3>AI Settings</h3>
                        <button class="settings-close" onclick="AIPanel.closeSettings()">&#10005;</button>
                    </div>
                    <div class="settings-content">
                        <div class="settings-group">
                            <label class="settings-label">Chat &amp; Notes Model</label>
                            <select id="settings-chat-model" class="settings-select" onchange="AICoworker.setChatModel(this.value)">
                                <option value="claude-haiku-3-5-20241022">Haiku 3.5 — Fast</option>
                                <option value="claude-sonnet-4-20250514" selected>Sonnet 4 — Balanced</option>
                                <option value="claude-opus-4-20250514">Opus 4 — Highest quality</option>
                            </select>
                        </div>
                        <div class="settings-group">
                            <label class="settings-label">Analysis Model</label>
                            <select id="settings-analysis-model" class="settings-select" onchange="AICoworker.setAnalysisModel(this.value)">
                                <option value="claude-haiku-3-5-20241022" selected>Haiku 3.5 — Fast</option>
                                <option value="claude-sonnet-4-20250514">Sonnet 4 — Balanced</option>
                                <option value="claude-opus-4-20250514">Opus 4 — Highest quality</option>
                            </select>
                            <p class="settings-hint">Used for chart analysis and clinical synthesis</p>
                        </div>
                        <div class="settings-actions">
                            <button class="btn btn-sm" onclick="AIPanel.configureApiKey()">&#128273; Configure API Key</button>
                            <button class="btn btn-sm" onclick="AIPanel.testConnection()">Test API Connection</button>
                            <button class="btn btn-sm btn-secondary" onclick="AICoworker.clearMemory()">Clear AI Memory</button>
                        </div>
                    </div>
                </div>

            </aside>
        </div>
    </div>

    <!-- AI Panel Toggle Button (shown when panel is collapsed) -->
    <button class="ai-panel-floating-btn" id="ai-panel-floating-btn" onclick="AIPanel.expand()" title="Open AI Assistant">
        <span>&#10024;</span>
        <span class="btn-label">AI Assistant</span>
    </button>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Chat trigger buttons -->
    <div id="chat-trigger-buttons" class="chat-trigger-buttons">
    </div>

    <!--
        Cache-busting: All local scripts use a version query parameter.
        To bust cache after a deploy, run in terminal:
          sed -i '' 's/v=[0-9]*b\?/v='$(date +%Y%m%d%H%M)'/g' index.html
        Or just change the version below and it propagates everywhere.
    -->
    <script>window.__CACHE_V = '20260224b';</script>

    <!-- Scripts — all versioned for cache busting -->
    <script src="js/utils/date-utils.js?v=20260224b"></script>
    <script src="js/utils/lab-utils.js?v=20260224b"></script>
    <script src="js/utils/search.js?v=20260224b"></script>
    <script src="js/data-loader.js?v=20260224b"></script>
    <!-- Simulation Engine -->
    <script src="js/services/simulation-engine.js?v=20260224b"></script>
    <script src="js/services/physiology-engine.js?v=20260224b"></script>
    <script src="js/services/intervention-tracker.js?v=20260224b"></script>
    <script src="js/services/dynamic-labs.js?v=20260224b"></script>
    <script src="js/services/dynamic-imaging.js?v=20260224b"></script>
    <!-- Longitudinal Clinical Document -->
    <script src="js/services/longitudinal-document.js?v=20260224b"></script>
    <script src="js/services/longitudinal-builder.js?v=20260224b"></script>
    <script src="js/services/longitudinal-renderer.js?v=20260224b"></script>
    <script src="js/services/longitudinal-updater.js?v=20260224b"></script>
    <!-- AI Memory System -->
    <script src="js/services/session-context.js?v=20260224b"></script>
    <script src="js/services/working-memory.js?v=20260224b"></script>
    <script src="js/services/context-assembler.js?v=20260224b"></script>
    <script src="js/components/patient-header.js?v=20260224b"></script>
    <script src="js/components/navigation.js?v=20260224b"></script>
    <script src="js/components/global-search.js?v=20260224b"></script>
    <script src="js/components/chart-review.js?v=20260224b"></script>
    <script src="js/components/notes-list.js?v=20260224b"></script>
    <script src="js/components/note-viewer.js?v=20260224b"></script>
    <script src="js/components/labs-table.js?v=20260224b"></script>
    <script src="js/components/lab-trending.js?v=20260224b"></script>
    <script src="js/components/medications.js?v=20260224b"></script>
    <script src="js/components/problems.js?v=20260224b"></script>
    <script src="js/components/vitals.js?v=20260224b"></script>
    <script src="js/components/encounters.js?v=20260224b"></script>
    <script src="js/components/allergies.js?v=20260224b"></script>
    <script src="js/components/imaging.js?v=20260224b"></script>
    <script src="js/components/history.js?v=20260224b"></script>
    <script src="js/components/procedures.js?v=20260224b"></script>
    <script src="js/components/orders.js?v=20260224b"></script>
    <script src="js/components/order-entry.js?v=20260224b"></script>
    <!-- AI Panel Components -->
    <script src="js/services/claude-api.js?v=20260224b"></script>
    <script src="js/services/google-doc-context.js?v=20260224b"></script>
    <script src="js/services/speech-service.js?v=20260224b"></script>
    <script src="js/components/ai-panel.js?v=20260224b"></script>
    <script src="js/components/floating-chat.js?v=20260224b"></script>
    <script src="js/components/patient-chat.js?v=20260224b"></script>
    <script src="js/components/nurse-chat.js?v=20260224b"></script>
    <script src="js/components/simulation-controls.js?v=20260224b"></script>
    <script src="js/components/live-vitals-banner.js?v=20260224b"></script>
    <script src="js/components/simulation-log.js?v=20260224b"></script>
    <script src="js/services/simulation-score-tracker.js?v=20260224b"></script>
    <script src="js/components/simulation-debrief.js?v=20260224b"></script>
    <script src="js/components/clinical-images.js?v=20260224b"></script>
    <script src="js/components/about.js?v=20260224b"></script>
    <script src="js/components/tutorial.js?v=20260224b"></script>
    <script src="js/components/ai-coworker.js?v=20260224b"></script>
    <script src="js/router.js?v=20260224b"></script>
    <script src="js/app.js?v=20260224b"></script>
</body>
</html>
